(()=>{var mt=Object.create;var W=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var vt=Object.getOwnPropertyNames;var ht=Object.getPrototypeOf,gt=Object.prototype.hasOwnProperty;var bt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var yt=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of vt(e))!gt.call(t,i)&&i!==n&&W(t,i,{get:()=>e[i],enumerable:!(r=_t(e,i))||r.enumerable});return t};var wt=(t,e,n)=>(n=t!=null?mt(ht(t)):{},yt(e||!t||!t.__esModule?W(n,"default",{value:t,enumerable:!0}):n,t));var pt=bt((Pt,ft)=>{"use strict";function kt(t){var e=Number(t.version.split(".")[0]);if(e>=2)t.mixin({beforeCreate:r});else{var n=t.prototype._init;t.prototype._init=function(i){i===void 0&&(i={}),i.init=i.init?[r].concat(i.init):r,n.call(this,i)}}function r(){var i=this.$options;i.store?this.$store=typeof i.store=="function"?i.store():i.store:i.parent&&i.parent.$store&&(this.$store=i.parent.$store)}}var $t=typeof window!="undefined"?window:typeof global!="undefined"?global:{},B=$t.__VUE_DEVTOOLS_GLOBAL_HOOK__;function Et(t){!B||(t._devtoolHook=B,B.emit("vuex:init",t),B.on("vuex:travel-to-state",function(e){t.replaceState(e)}),t.subscribe(function(e,n){B.emit("vuex:mutation",e,n)},{prepend:!0}),t.subscribeAction(function(e,n){B.emit("vuex:action",e,n)},{prepend:!0}))}function Nt(t,e){return t.filter(e)[0]}function U(t,e){if(e===void 0&&(e=[]),t===null||typeof t!="object")return t;var n=Nt(e,function(i){return i.original===t});if(n)return n.copy;var r=Array.isArray(t)?[]:{};return e.push({original:t,copy:r}),Object.keys(t).forEach(function(i){r[i]=U(t[i],e)}),r}function z(t,e){Object.keys(t).forEach(function(n){return e(t[n],n)})}function nt(t){return t!==null&&typeof t=="object"}function xt(t){return t&&typeof t.then=="function"}function Ot(t,e){return function(){return t(e)}}var D=function(e,n){this.runtime=n,this._children=Object.create(null),this._rawModule=e;var r=e.state;this.state=(typeof r=="function"?r():r)||{}},at={namespaced:{configurable:!0}};at.namespaced.get=function(){return!!this._rawModule.namespaced};D.prototype.addChild=function(e,n){this._children[e]=n};D.prototype.removeChild=function(e){delete this._children[e]};D.prototype.getChild=function(e){return this._children[e]};D.prototype.hasChild=function(e){return e in this._children};D.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)};D.prototype.forEachChild=function(e){z(this._children,e)};D.prototype.forEachGetter=function(e){this._rawModule.getters&&z(this._rawModule.getters,e)};D.prototype.forEachAction=function(e){this._rawModule.actions&&z(this._rawModule.actions,e)};D.prototype.forEachMutation=function(e){this._rawModule.mutations&&z(this._rawModule.mutations,e)};Object.defineProperties(D.prototype,at);var T=function(e){this.register([],e,!1)};T.prototype.get=function(e){return e.reduce(function(n,r){return n.getChild(r)},this.root)};T.prototype.getNamespace=function(e){var n=this.root;return e.reduce(function(r,i){return n=n.getChild(i),r+(n.namespaced?i+"/":"")},"")};T.prototype.update=function(e){rt([],this.root,e)};T.prototype.register=function(e,n,r){var i=this;r===void 0&&(r=!0);var l=new D(n,r);if(e.length===0)this.root=l;else{var g=this.get(e.slice(0,-1));g.addChild(e[e.length-1],l)}n.modules&&z(n.modules,function(_,m){i.register(e.concat(m),_,r)})};T.prototype.unregister=function(e){var n=this.get(e.slice(0,-1)),r=e[e.length-1],i=n.getChild(r);!i||!i.runtime||n.removeChild(r)};T.prototype.isRegistered=function(e){var n=this.get(e.slice(0,-1)),r=e[e.length-1];return n?n.hasChild(r):!1};function rt(t,e,n){if(e.update(n),n.modules)for(var r in n.modules){if(!e.getChild(r))return;rt(t.concat(r),e.getChild(r),n.modules[r])}}var C,M=function(e){var n=this;e===void 0&&(e={}),!C&&typeof window!="undefined"&&window.Vue&&st(window.Vue);var r=e.plugins;r===void 0&&(r=[]);var i=e.strict;i===void 0&&(i=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new T(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new C,this._makeLocalGettersCache=Object.create(null);var l=this,g=this,_=g.dispatch,m=g.commit;this.dispatch=function(k,N){return _.call(l,k,N)},this.commit=function(k,N,L){return m.call(l,k,N,L)},this.strict=i;var v=this._modules.root.state;H(this,v,[],this._modules.root),J(this,v),r.forEach(function(y){return y(n)});var f=e.devtools!==void 0?e.devtools:C.config.devtools;f&&Et(this)},Y={state:{configurable:!0}};Y.state.get=function(){return this._vm._data.$$state};Y.state.set=function(t){};M.prototype.commit=function(e,n,r){var i=this,l=F(e,n,r),g=l.type,_=l.payload,m=l.options,v={type:g,payload:_},f=this._mutations[g];!f||(this._withCommit(function(){f.forEach(function(k){k(_)})}),this._subscribers.slice().forEach(function(y){return y(v,i.state)}))};M.prototype.dispatch=function(e,n){var r=this,i=F(e,n),l=i.type,g=i.payload,_={type:l,payload:g},m=this._actions[l];if(!!m){try{this._actionSubscribers.slice().filter(function(f){return f.before}).forEach(function(f){return f.before(_,r.state)})}catch(f){}var v=m.length>1?Promise.all(m.map(function(f){return f(g)})):m[0](g);return new Promise(function(f,y){v.then(function(k){try{r._actionSubscribers.filter(function(N){return N.after}).forEach(function(N){return N.after(_,r.state)})}catch(N){}f(k)},function(k){try{r._actionSubscribers.filter(function(N){return N.error}).forEach(function(N){return N.error(_,r.state,k)})}catch(N){}y(k)})})}};M.prototype.subscribe=function(e,n){return ot(e,this._subscribers,n)};M.prototype.subscribeAction=function(e,n){var r=typeof e=="function"?{before:e}:e;return ot(r,this._actionSubscribers,n)};M.prototype.watch=function(e,n,r){var i=this;return this._watcherVM.$watch(function(){return e(i.state,i.getters)},n,r)};M.prototype.replaceState=function(e){var n=this;this._withCommit(function(){n._vm._data.$$state=e})};M.prototype.registerModule=function(e,n,r){r===void 0&&(r={}),typeof e=="string"&&(e=[e]),this._modules.register(e,n),H(this,this.state,e,this._modules.get(e),r.preserveState),J(this,this.state)};M.prototype.unregisterModule=function(e){var n=this;typeof e=="string"&&(e=[e]),this._modules.unregister(e),this._withCommit(function(){var r=X(n.state,e.slice(0,-1));C.delete(r,e[e.length-1])}),it(this)};M.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),this._modules.isRegistered(e)};M.prototype.hotUpdate=function(e){this._modules.update(e),it(this,!0)};M.prototype._withCommit=function(e){var n=this._committing;this._committing=!0,e(),this._committing=n};Object.defineProperties(M.prototype,Y);function ot(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var r=e.indexOf(t);r>-1&&e.splice(r,1)}}function it(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;H(t,n,[],t._modules.root,!0),J(t,n,e)}function J(t,e,n){var r=t._vm;t.getters={},t._makeLocalGettersCache=Object.create(null);var i=t._wrappedGetters,l={};z(i,function(_,m){l[m]=Ot(_,t),Object.defineProperty(t.getters,m,{get:function(){return t._vm[m]},enumerable:!0})});var g=C.config.silent;C.config.silent=!0,t._vm=new C({data:{$$state:e},computed:l}),C.config.silent=g,t.strict&&Dt(t),r&&(n&&t._withCommit(function(){r._data.$$state=null}),C.nextTick(function(){return r.$destroy()}))}function H(t,e,n,r,i){var l=!n.length,g=t._modules.getNamespace(n);if(r.namespaced&&(t._modulesNamespaceMap[g],t._modulesNamespaceMap[g]=r),!l&&!i){var _=X(e,n.slice(0,-1)),m=n[n.length-1];t._withCommit(function(){C.set(_,m,r.state)})}var v=r.context=At(t,g,n);r.forEachMutation(function(f,y){var k=g+y;Mt(t,k,f,v)}),r.forEachAction(function(f,y){var k=f.root?y:g+y,N=f.handler||f;Vt(t,k,N,v)}),r.forEachGetter(function(f,y){var k=g+y;St(t,k,f,v)}),r.forEachChild(function(f,y){H(t,e,n.concat(y),f,i)})}function At(t,e,n){var r=e==="",i={dispatch:r?t.dispatch:function(l,g,_){var m=F(l,g,_),v=m.payload,f=m.options,y=m.type;return(!f||!f.root)&&(y=e+y),t.dispatch(y,v)},commit:r?t.commit:function(l,g,_){var m=F(l,g,_),v=m.payload,f=m.options,y=m.type;(!f||!f.root)&&(y=e+y),t.commit(y,v,f)}};return Object.defineProperties(i,{getters:{get:r?function(){return t.getters}:function(){return Ct(t,e)}},state:{get:function(){return X(t.state,n)}}}),i}function Ct(t,e){if(!t._makeLocalGettersCache[e]){var n={},r=e.length;Object.keys(t.getters).forEach(function(i){if(i.slice(0,r)===e){var l=i.slice(r);Object.defineProperty(n,l,{get:function(){return t.getters[i]},enumerable:!0})}}),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}function Mt(t,e,n,r){var i=t._mutations[e]||(t._mutations[e]=[]);i.push(function(g){n.call(t,r.state,g)})}function Vt(t,e,n,r){var i=t._actions[e]||(t._actions[e]=[]);i.push(function(g){var _=n.call(t,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:t.getters,rootState:t.state},g);return xt(_)||(_=Promise.resolve(_)),t._devtoolHook?_.catch(function(m){throw t._devtoolHook.emit("vuex:error",m),m}):_})}function St(t,e,n,r){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(l){return n(r.state,r.getters,l.state,l.getters)})}function Dt(t){t._vm.$watch(function(){return this._data.$$state},function(){},{deep:!0,sync:!0})}function X(t,e){return e.reduce(function(n,r){return n[r]},t)}function F(t,e,n){return nt(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}function st(t){C&&t===C||(C=t,kt(C))}var ct=R(function(t,e){var n={};return K(e).forEach(function(r){var i=r.key,l=r.val;n[i]=function(){var _=this.$store.state,m=this.$store.getters;if(t){var v=I(this.$store,"mapState",t);if(!v)return;_=v.context.state,m=v.context.getters}return typeof l=="function"?l.call(this,_,m):_[l]},n[i].vuex=!0}),n}),ut=R(function(t,e){var n={};return K(e).forEach(function(r){var i=r.key,l=r.val;n[i]=function(){for(var _=[],m=arguments.length;m--;)_[m]=arguments[m];var v=this.$store.commit;if(t){var f=I(this.$store,"mapMutations",t);if(!f)return;v=f.context.commit}return typeof l=="function"?l.apply(this,[v].concat(_)):v.apply(this.$store,[l].concat(_))}}),n}),dt=R(function(t,e){var n={};return K(e).forEach(function(r){var i=r.key,l=r.val;l=t+l,n[i]=function(){if(!(t&&!I(this.$store,"mapGetters",t)))return this.$store.getters[l]},n[i].vuex=!0}),n}),lt=R(function(t,e){var n={};return K(e).forEach(function(r){var i=r.key,l=r.val;n[i]=function(){for(var _=[],m=arguments.length;m--;)_[m]=arguments[m];var v=this.$store.dispatch;if(t){var f=I(this.$store,"mapActions",t);if(!f)return;v=f.context.dispatch}return typeof l=="function"?l.apply(this,[v].concat(_)):v.apply(this.$store,[l].concat(_))}}),n}),jt=function(t){return{mapState:ct.bind(null,t),mapGetters:dt.bind(null,t),mapMutations:ut.bind(null,t),mapActions:lt.bind(null,t)}};function K(t){return Gt(t)?Array.isArray(t)?t.map(function(e){return{key:e,val:e}}):Object.keys(t).map(function(e){return{key:e,val:t[e]}}):[]}function Gt(t){return Array.isArray(t)||nt(t)}function R(t){return function(e,n){return typeof e!="string"?(n=e,e=""):e.charAt(e.length-1)!=="/"&&(e+="/"),t(e,n)}}function I(t,e,n){var r=t._modulesNamespaceMap[n];return r}function Lt(t){t===void 0&&(t={});var e=t.collapsed;e===void 0&&(e=!0);var n=t.filter;n===void 0&&(n=function(f,y,k){return!0});var r=t.transformer;r===void 0&&(r=function(f){return f});var i=t.mutationTransformer;i===void 0&&(i=function(f){return f});var l=t.actionFilter;l===void 0&&(l=function(f,y){return!0});var g=t.actionTransformer;g===void 0&&(g=function(f){return f});var _=t.logMutations;_===void 0&&(_=!0);var m=t.logActions;m===void 0&&(m=!0);var v=t.logger;return v===void 0&&(v=console),function(f){var y=U(f.state);typeof v!="undefined"&&(_&&f.subscribe(function(k,N){var L=U(N);if(n(k,y,L)){var a=et(),o=i(k),s="mutation "+k.type+a;Z(v,s,e),v.log("%c prev state","color: #9E9E9E; font-weight: bold",r(y)),v.log("%c mutation","color: #03A9F4; font-weight: bold",o),v.log("%c next state","color: #4CAF50; font-weight: bold",r(L)),tt(v)}y=L}),m&&f.subscribeAction(function(k,N){if(l(k,N)){var L=et(),a=g(k),o="action "+k.type+L;Z(v,o,e),v.log("%c action","color: #03A9F4; font-weight: bold",a),tt(v)}}))}}function Z(t,e,n){var r=n?t.groupCollapsed:t.group;try{r.call(t,e)}catch(i){t.log(e)}}function tt(t){try{t.groupEnd()}catch(e){t.log("\u2014\u2014 log end \u2014\u2014")}}function et(){var t=new Date;return" @ "+P(t.getHours(),2)+":"+P(t.getMinutes(),2)+":"+P(t.getSeconds(),2)+"."+P(t.getMilliseconds(),3)}function Tt(t,e){return new Array(e+1).join(t)}function P(t,e){return Tt("0",e-t.toString().length)+t}var Bt={Store:M,install:st,version:"3.6.2",mapState:ct,mapMutations:ut,mapGetters:dt,mapActions:lt,createNamespacedHelpers:jt,createLogger:Lt};ft.exports=Bt});var q=wt(pt(),1),{Store:Ft,install:Ht,version:Kt,mapState:Rt,mapMutations:It,mapGetters:qt,mapActions:Ut,createNamespacedHelpers:Yt,createLogger:Jt}=q.default;frappe.provide("frappe.views");(function(){var t="frappe.desk.doctype.kanban_board.kanban_board.";let e=null;var n=new q.default.Store({state:{doctype:"",board:{},card_meta:{},cards:[],columns:[],filters_modified:!1,cur_list:{},empty_state:!0},mutations:{update_state(a,o){Object.assign(a,o)}},actions:{init:function(a,o){a.commit("update_state",{empty_state:!0});var s=o.board,c=o.card_meta;o.card_meta=c,o.board=s;var d=o.cards.map(function(x){return r(x,o)}),w=i(s.columns);a.commit("update_state",{doctype:o.doctype,board:s,card_meta:c,cards:d,columns:w,cur_list:o.cur_list,empty_state:!1,wrapper:o.wrapper})},update_cards:function(a,o){var s=a.state,c=o.map(d=>r(d,s)).concat(s.cards).uniqBy(d=>d.name);a.commit("update_state",{cards:c})},add_column:function(a,o){frappe.model.can_create("Custom Field")?n.dispatch("update_column",{col:o,action:"add"}):frappe.msgprint({title:__("Not permitted"),message:__("You are not allowed to create columns"),indicator:"red"})},archive_column:function(a,o){n.dispatch("update_column",{col:o,action:"archive"})},restore_column:function(a,o){n.dispatch("update_column",{col:o,action:"restore"})},update_column:function(a,{col:o,action:s}){var c=a.state.doctype,d=a.state.board;g(c).then(function(w){return l(w,d,o.title,s)}).then(_).then(function(){return v(d.name,o.title,s)}).then(function(w){var x=w.message;a.commit("update_state",{columns:i(x)})},function(w){console.error(w)})},add_card:function(a,{card_title:o,column_title:s}){var c=a.state,d=frappe.model.get_new_doc(c.doctype),w=c.card_meta.title_field,x=c.card_meta.quick_entry,A={};A[w.fieldname]=o,A[c.board.field_name]=s,c.cur_list.filter_area.get().forEach(function(u){u[2]==="="&&(A[u[1]]=u[3])}),$.extend(d,A);let V=r(d,c);V._disable_click=!0;let j=[...c.cards,V],E=d.name;if(a.commit("update_state",{cards:j}),w&&!x)return m(d).then(function(u){let p=u.message,b=c.cards.findIndex(S=>S.name===E),h=r(p,c),O=c.cards.slice();O[b]=h,a.commit("update_state",{cards:O});let G={new:1,name:h.name,colname:p[c.board.field_name]};n.dispatch("update_order_for_single_card",G)});frappe.new_doc(c.doctype,d)},update_card:function(a,o){var s=-1;a.state.cards.forEach(function(d,w){d.name===o.name&&(s=w)});var c=a.state.cards.slice();s!==-1&&c.splice(s,1,o),a.commit("update_state",{cards:c})},update_order_for_single_card:function(a,o){let s=a.state.cards.slice(),c=a.state.columns.slice(),d={},w="";o.new?(w="add_card",d={board_name:a.state.board.name,docname:o.name,colname:o.colname}):(w="update_order_for_single_card",d={board_name:a.state.board.name,docname:o.name,from_colname:o.from_colname,to_colname:o.to_colname,old_index:o.old_index,new_index:o.new_index}),frappe.dom.freeze(),frappe.call({method:t+w,args:d,callback:x=>{let A=x.message,V=[{name:o.name,column:o.to_colname||o.colname}],j=N(V),E=i(A.columns);a.commit("update_state",{cards:j,columns:E}),frappe.dom.unfreeze()}}).fail(function(){a.commit("update_state",{cards:s,columns:c}),frappe.dom.unfreeze()})},update_order:function(a){let o=a.state.cards.slice(),s=a.state.columns.slice(),c={};a.state.wrapper.find(".kanban-column[data-column-value]").each(function(){var d=$(this).data().columnValue;c[d]=[],$(this).find(".kanban-card-wrapper").each(function(){var w=decodeURIComponent($(this).data().name);c[d].push(w)})}),frappe.call({method:t+"update_order",args:{board_name:a.state.board.name,order:c},callback:d=>{var w=d.message[0],x=d.message[1],A=N(x),V=i(w.columns);a.commit("update_state",{cards:A,columns:V})}}).fail(function(){a.commit("update_state",{cards:o,columns:s})})},update_column_order:function(a,o){return frappe.call({method:t+"update_column_order",args:{board_name:a.state.board.name,order:o}}).then(function(s){var c=s.message,d=i(c.columns);a.commit("update_state",{columns:d})})},set_indicator:function(a,{column:o,color:s}){return frappe.call({method:t+"set_indicator",args:{board_name:a.state.board.name,column_name:o.title,indicator:s}}).then(function(c){var d=c.message,w=i(d.columns);a.commit("update_state",{columns:w})})}}});frappe.views.KanbanBoard=function(a){var o={};o.wrapper=a.wrapper,o.cur_list=a.cur_list,o.board_name=a.board_name,o.board_perms=o.cur_list.board_perms,o.update=function(u){a.cards=u,o.wrapper.find(".kanban").length>0&&o.cur_list.start!==0?n.dispatch("update_cards",u):s()};function s(){n.dispatch("init",a),e&&e(),n.watch((u,p)=>u.columns,d),c(),n.watch((u,p)=>u.cur_list,j),e=n.watch((u,p)=>u.columns,j),n.watch((u,p)=>u.empty_state,E),n.dispatch("update_order")}function c(){o.$kanban_board=o.wrapper.find(".kanban"),o.$kanban_board.length===0&&(o.$kanban_board=$(frappe.render_template("kanban_board")),o.$kanban_board.appendTo(o.wrapper)),o.$filter_area=o.cur_list.$page.find(".active-tag-filters"),w(),x()}function d(){o.$kanban_board.find(".kanban-column").not(".add-new-column").remove();var u=n.state.columns;u.filter(f).map(function(p){frappe.views.KanbanBoardColumn(p,o.$kanban_board,o.board_perms)})}function w(){A(),V()}function x(){if(!!o.board_perms.write)var u=new Sortable(o.$kanban_board.get(0),{group:"columns",animation:150,dataIdAttr:"data-column-value",filter:".add-new-column",handle:".kanban-column-title",onEnd:function(){var p=u.toArray();p=p.slice(1),n.dispatch("update_column_order",p)}})}function A(){if(!o.board_perms.write){o.$kanban_board.find(".add-new-column").remove();return}var u=o.$kanban_board.find(".add-new-column"),p=u.find(".compose-column"),b=u.find(".compose-column-form").hide();p.on("click",function(){$(this).hide(),b.show(),b.find("input").focus()}),b.keydown(function(h){if(h.which==13&&(h.preventDefault(),!frappe.request.ajax_count)){var O=b.serializeArray()[0].value,G={title:O.trim()};n.dispatch("add_column",G),b.find("input").val(""),p.show(),b.hide()}}),b.find("input").on("blur",function(){$(this).val(""),p.show(),b.hide()})}function V(){let u=!1,p,b,h=o.$kanban_board[0];h.addEventListener("mousedown",O=>{[".kanban-column .kanban-column-header",".kanban-column .add-card",".kanban-column .kanban-card.new-card-area",".kanban-card-wrapper"].some(S=>O.target.closest(S))||(u=!0,h.classList.add("clickdrag-active"),p=O.pageX-h.offsetLeft,b=h.scrollLeft)}),h.addEventListener("mouseleave",()=>{u=!1,h.classList.remove("clickdrag-active")}),h.addEventListener("mouseup",()=>{u=!1,h.classList.remove("clickdrag-active")}),h.addEventListener("mousemove",O=>{if(!u)return;O.preventDefault();let S=O.pageX-h.offsetLeft-p;h.scrollLeft=b-S})}function j(){var u=n.state.cur_list,p=n.state.columns,b=u.$page.find("[data-list-renderer='Kanban'] .list-row-right").css("margin-right","15px");b.empty();var h=p.filter(function(S){return S.status==="Archived"});if(!!h.length){var O=h.reduce(function(S,Q){return S+`<li><a class='option'>" +
					"<span class='ellipsis' style='max-width: 100px; display: inline-block'>" +
					__(b.title) + "</span>" +
					"<button style='float:right;' data-column='" + b.title +
					"' class='btn btn-default btn-xs restore-column text-muted'>"
					+ __('Restore') + "</button></a></li>`},""),G=$("<div class='dropdown pull-right'><a class='text-muted dropdown-toggle' data-toggle='dropdown'><span class='dropdown-text'>"+__("Archived Columns")+"</span><i class='caret'></i></a><ul class='dropdown-menu'>"+O+"</ul></div>");b.html(G),G.find(".dropdown-menu").on("click","button.restore-column",function(){var S=$(this).data().column,Q={title:S,status:"Archived"};n.dispatch("restore_column",Q)})}}function E(){var u=n.state.empty_state;u?(o.$kanban_board.find(".kanban-column").hide(),o.$kanban_board.find(".kanban-empty-state").show()):(o.$kanban_board.find(".kanban-column").show(),o.$kanban_board.find(".kanban-empty-state").hide())}return s(),o},frappe.views.KanbanBoardColumn=function(a,o,s){var c={},d=[];function w(){x(),V(),A(),n.watch((u,p)=>u.cards,A),j(),E()}function x(){c.$kanban_column=$(frappe.render_template("kanban_column",{title:a.title,doctype:n.state.doctype,indicator:frappe.scrub(a.indicator,"-")})).appendTo(o),c.$kanban_cards=c.$kanban_column.find(".kanban-cards")}function A(){c.$kanban_cards.empty();var u=n.state.cards;d=y(u,a);var p=d.map(h=>h.name),b=a.order;b?(b=JSON.parse(b),d.forEach(function(h){b.indexOf(h.name)===-1&&frappe.views.KanbanBoardCard(h,c.$kanban_cards)}),b.forEach(function(h){!p.includes(h)||frappe.views.KanbanBoardCard(k(h),c.$kanban_cards)})):d.map(function(h){frappe.views.KanbanBoardCard(h,c.$kanban_cards)})}function V(){!frappe.model.can_write(n.state.doctype)||Sortable.create(c.$kanban_cards.get(0),{group:"cards",animation:150,dataIdAttr:"data-name",forceFallback:!0,onStart:function(){o.find(".kanban-card.add-card").fadeOut(200,function(){o.find(".kanban-cards").height("100vh")})},onEnd:function(u){o.find(".kanban-card.add-card").fadeIn(100),o.find(".kanban-cards").height("auto");let p={name:decodeURIComponent($(u.item).attr("data-name")),from_colname:$(u.from).parents(".kanban-column").attr("data-column-value"),to_colname:$(u.to).parents(".kanban-column").attr("data-column-value"),old_index:u.oldIndex,new_index:u.newIndex};n.dispatch("update_order_for_single_card",p)},onAdd:function(){}})}function j(){var u=c.$kanban_column,p=u.find(".add-card"),b=u.find(".new-card-area");if(!frappe.model.can_create(n.state.doctype)){p.remove(),b.remove();return}var h=b.find("textarea");b.hide(),p.on("click",function(){p.hide(),b.show(),h.focus()}),b.keydown(function(O){if(O.which==13&&(O.preventDefault(),!frappe.request.ajax_count)){O.preventDefault();var G=h.val();b.hide(),h.val(""),n.dispatch("add_card",{card_title:G,column_title:a.title}).then(()=>{p.show()})}}),h.on("blur",function(){$(this).val(""),p.show(),b.hide()})}function E(){if(!s.write){c.$kanban_column.find(".column-options").remove();return}c.$kanban_column.find(".column-options .dropdown-menu").on("click","[data-action]",function(){var u=$(this),p=u.data().action;if(p==="archive")n.dispatch("archive_column",a);else if(p==="indicator"){var b=u.data().indicator;n.dispatch("set_indicator",{column:a,color:b})}}),L(function(u){let p=`<li class="button-group">${u.map(b=>{let h=frappe.scrub(b,"-");return`<div data-action="indicator" data-indicator="${b}" class="btn btn-default btn-xs indicator-pill ${h}"></div>`}).join("")}</li>`;c.$kanban_column.find(".column-options .dropdown-menu").append(p)})}w()},frappe.views.KanbanBoardCard=function(a,o){var s={};function c(){!a||(d(),A())}function d(){var E={name:a.name,title:frappe.utils.html2text(a.title),disable_click:a._disable_click?"disable-click":"",creation:a.creation,doc_content:w(a),image_url:cur_list.get_image_url(a),form_link:frappe.utils.get_form_link(a.doctype,a.name)};s.$card=$(frappe.render_template("kanban_card",E)).appendTo(o),frappe.model.can_write(a.doctype)||s.$card.find(".kanban-card-body").css("cursor","default")}function w(E){let u=[];for(let p of cur_list.board.fields){let b=frappe.meta.get_docfield(E.doctype,p,E.name)||frappe.model.get_std_field(p),h=cur_list.board.show_labels?`<span>${__(b.label)}: </span>`:"",O=frappe.format(E.doc[p],b);u.push(`
					<div class="text-muted text-truncate">
						${h}
						<span>${O}</span>
					</div>
				`)}return u.join("")}function x(E){return E.tags?`<div class="kanban-tags">
					${cur_list.get_tags_html(E.tags,3,!0)}
				</div>`:""}function A(){let E=x(a);a.comment_count>0&&(E+=`<span class="list-comment-count small text-muted ">
					${frappe.utils.icon("small-message")}
					${a.comment_count}
				</span>`);let u=V();if(E+=`
				<span class="kanban-assignments"></span>
				${cur_list.get_like_html(a)}
			`,a.color&&frappe.ui.color.validate_hex(a.color)){let p=$("<div>");$("<div></div>").css({width:"30px",height:"4px",borderRadius:"2px",marginBottom:"8px",backgroundColor:a.color}).appendTo(p),s.$card.find(".kanban-card .kanban-title-area").prepend(p)}s.$card.find(".kanban-card-meta").empty().append(E).find(".kanban-assignments").append(u)}function V(){return frappe.avatar_group(a.assigned_list,3,{css_class:"avatar avatar-small",action_icon:"add",action:j})}function j(E){E.preventDefault(),E.stopPropagation(),s.assign_to=new frappe.ui.form.AssignToDialog({obj:s,method:"frappe.desk.form.assign_to.add",doctype:a.doctype,docname:a.name,callback:function(){let u=s.assign_to_dialog.get_values().assign_to;a.assigned_list=[...new Set(a.assigned_list.concat(u))],n.dispatch("update_card",a)}}),s.assign_to_dialog=s.assign_to.dialog,s.assign_to_dialog.show()}c()};function r(a,o,s){var c=a._assign?JSON.parse(a._assign):[],d=a._comment_count||0;return s&&(a=Object.assign({},a,s)),{doctype:o.doctype,name:a.name,title:a[o.card_meta.title_field.fieldname],creation:moment(a.creation).format("MMM DD, YYYY"),_liked_by:a._liked_by,image:a[cur_list.meta.image_field],tags:a._user_tags,column:a[o.board.field_name],assigned_list:a.assigned_list||c,comment_count:a.comment_count||d,color:a.color||null,doc:s||a}}function i(a){return a.map(function(o){return{title:o.column_name,status:o.status,order:o.order,indicator:o.indicator||"gray"}})}function l(a,o,s,c){return a.fields.forEach(function(d){if(d.fieldname===o.field_name&&d.fieldtype==="Select"){if(d.options||(d.options=""),c==="add")d.options.includes(s)||(d.options+=`
`+s);else if(c==="delete"){var w=d.options.split(`
`),x=w.indexOf(s);x!==-1&&w.splice(x,1),d.options=w.join(`
`)}}}),a}function g(a){return new Promise(function(o){frappe.model.with_doc("Customize Form","Customize Form",function(){var s=frappe.get_doc("Customize Form");s.doc_type=a,frappe.call({doc:s,method:"fetch_to_customize",callback:function(c){o(c.docs[0])}})})})}function _(a){if(!!a)return a.hide_success=!0,frappe.call({doc:a,method:"save_customization"})}function m(a){return frappe.call({method:"frappe.client.insert",args:{doc:a},callback:function(){frappe.model.clear_doc(a.doctype,a.name),frappe.show_alert({message:__("Saved"),indicator:"green"},1)}})}function v(a,o,s){var c,d={board_name:a,column_title:o};return s==="add"?c="add_column":(s==="archive"||s==="restore")&&(c="archive_restore_column",d.status=s==="archive"?"Archived":"Active"),frappe.call({method:t+c,args:d})}function f(a){return a.status!=="Archived"}function y(a,o){return a.filter(function(s){return s.column===o.title})}function k(a){return n.state.cards.find(function(o){return o.name===a})}function N(a){var o=n.state.cards;return o.forEach(function(s){a.forEach(function(c){c.name===s.name&&(s.column=c.column)})}),o}function L(a){frappe.model.with_doctype("Kanban Board Column",function(){var o=frappe.get_meta("Kanban Board Column"),s;o.fields.forEach(function(c){c.fieldname==="indicator"&&(s=c.options.split(`
`))}),s||(s=["green","blue","orange","gray"]),a(s)})}})();})();
/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */
//# sourceMappingURL=kanban_board.bundle.PAEZMWCU.js.map
